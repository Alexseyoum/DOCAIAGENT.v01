<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Processing Agent - Interactive Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .status {
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 20px;
            font-weight: bold;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .section h3 {
            color: #764ba2;
            margin-bottom: 15px;
            margin-top: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1em;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin: 5px;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #764ba2;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-success {
            background: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .result-box {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Monaco', 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }

        .hidden {
            display: none;
        }

        .login-section, .app-section {
            display: none;
        }

        .login-section.active, .app-section.active {
            display: block;
        }

        .document-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .document-item.selected {
            border: 2px solid #667eea;
            background: #f0f4ff;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
        }

        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-info { background: #dbeafe; color: #1e40af; }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: bold;
            color: #6b7280;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: 500;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.9em;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Document Processing Agent</h1>
            <p>AI-Powered Document Analysis & Educational Content Generation</p>
            <div class="status">‚úÖ API is Live & Running</div>
        </div>

        <div class="content">
            <!-- Login/Register Section -->
            <div id="loginSection" class="login-section active">
                <div class="section">
                    <h2>üîê Get Started</h2>
                    <p>Register or login to access the document processing features.</p>

                    <div class="tabs">
                        <button class="tab active" onclick="switchAuthTab('register')">Register</button>
                        <button class="tab" onclick="switchAuthTab('login')">Login</button>
                    </div>

                    <!-- Register Tab -->
                    <div id="registerTab" class="tab-content active">
                        <div class="form-group">
                            <label>Email:</label>
                            <input type="email" id="regEmail" placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label>Password:</label>
                            <input type="password" id="regPassword" placeholder="Minimum 6 characters">
                        </div>
                        <div class="form-group">
                            <label>Name:</label>
                            <input type="text" id="regName" placeholder="Your Name">
                        </div>
                        <button id="registerBtn" class="btn btn-success">Register & Get Started</button>
                    </div>

                    <!-- Login Tab -->
                    <div id="loginTab" class="tab-content">
                        <div class="form-group">
                            <label>Email:</label>
                            <input type="email" id="loginEmail" placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label>Password:</label>
                            <input type="password" id="loginPassword" placeholder="Your password">
                        </div>
                        <button id="loginBtn" class="btn btn-success">Login</button>
                    </div>

                    <div id="authResult" class="result-box hidden"></div>
                </div>
            </div>

            <!-- Main App Section (shown after login) -->
            <div id="appSection" class="app-section">
                <!-- User Info -->
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3>Welcome, <span id="userName">User</span>!</h3>
                            <p>Email: <span id="userEmail">user@example.com</span></p>
                        </div>
                        <button class="btn btn-danger" id="logoutBtn">Logout</button>
                    </div>
                </div>

                <!-- Document Upload -->
                <div class="section">
                    <h2>üì§ Upload Document</h2>
                    <div class="form-group">
                        <label>Select File (PDF, DOCX, TXT, CSV, XLSX - Max 50MB):</label>
                        <input type="file" id="fileInput" accept=".pdf,.docx,.doc,.txt,.csv,.xlsx">
                    </div>
                    <button class="btn btn-success" id="uploadBtn">
                        <span id="uploadBtnText">Upload Document</span>
                    </button>
                    <div id="uploadResult" class="hidden"></div>
                </div>

                <!-- My Documents -->
                <div class="section">
                    <h2>üìö My Documents</h2>
                    <button class="btn" id="refreshDocsBtn">Refresh List</button>
                    <div id="documentsList"></div>
                </div>

                <!-- Content Generation -->
                <div class="section">
                    <h2>üéØ Generate Content</h2>
                    <div id="noDocSelected" class="alert alert-info">
                        ‚ÑπÔ∏è Select a document from "My Documents" above to generate content.
                    </div>

                    <div id="contentGeneration" class="hidden">
                        <div class="alert alert-success">
                            ‚úÖ Selected: <strong id="selectedDocName"></strong>
                            <button class="btn" style="float: right;" id="processBtn">
                                <span id="processBtnText">Extract Text</span>
                            </button>
                        </div>

                        <div class="tabs">
                            <button class="tab active" data-tab="summary">üìù Summary</button>
                            <button class="tab" data-tab="quiz">‚ùì Quiz</button>
                            <button class="tab" data-tab="flashcards">üé¥ Flashcards</button>
                        </div>

                        <!-- Summary Tab -->
                        <div id="summaryTab" class="tab-content active">
                            <div class="form-group">
                                <label>Summary Type:</label>
                                <select id="summaryType">
                                    <option value="brief">Brief (Quick overview)</option>
                                    <option value="standard">Standard (Medium detail)</option>
                                    <option value="detailed">Detailed (Comprehensive)</option>
                                </select>
                            </div>
                            <button class="btn btn-success" id="generateSummaryBtn">
                                <span id="summaryBtnText">Generate Summary</span>
                            </button>
                            <div id="summaryResult" class="hidden"></div>
                        </div>

                        <!-- Quiz Tab -->
                        <div id="quizTab" class="tab-content">
                            <div class="form-group">
                                <label>Number of Questions:</label>
                                <input type="number" id="questionCount" value="5" min="1" max="20">
                            </div>
                            <div class="form-group">
                                <label>Question Types:</label>
                                <select id="questionTypes" multiple>
                                    <option value="multiple_choice" selected>Multiple Choice</option>
                                    <option value="true_false">True/False</option>
                                    <option value="short_answer">Short Answer</option>
                                </select>
                            </div>
                            <button class="btn btn-success" id="generateQuizBtn">
                                <span id="quizBtnText">Generate Quiz</span>
                            </button>
                            <div id="quizResult" class="hidden"></div>
                        </div>

                        <!-- Flashcards Tab -->
                        <div id="flashcardsTab" class="tab-content">
                            <div class="form-group">
                                <label>Number of Cards:</label>
                                <input type="number" id="cardCount" value="10" min="1" max="50">
                            </div>
                            <button class="btn btn-success" id="generateFlashcardsBtn">
                                <span id="flashcardsBtnText">Generate Flashcards</span>
                            </button>
                            <div id="flashcardsResult" class="hidden"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin + '/api/v1';
        let currentUser = {
            token: null,
            email: null,
            name: null
        };
        let selectedDocumentId = null;
        let documents = [];

        // Initialize
        window.addEventListener('load', () => {
            console.log('[INIT] Page loaded');
            // Check if user is already logged in (from session storage)
            const savedToken = sessionStorage.getItem('apiToken');
            const savedEmail = sessionStorage.getItem('userEmail');
            const savedName = sessionStorage.getItem('userName');

            if (savedToken) {
                currentUser.token = savedToken;
                currentUser.email = savedEmail;
                currentUser.name = savedName;
                showApp();
            }
        });

        // Auth Tab Switching
        function switchAuthTab(tab) {
            document.querySelectorAll('.tabs .tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            if (tab === 'register') {
                document.querySelector('.tabs .tab:first-child').classList.add('active');
                document.getElementById('registerTab').classList.add('active');
            } else {
                document.querySelector('.tabs .tab:last-child').classList.add('active');
                document.getElementById('loginTab').classList.add('active');
            }
        }

        // Content Tab Switching
        function switchContentTab(tab) {
            document.querySelectorAll('.section .tabs .tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.section .tab-content').forEach(c => c.classList.remove('active'));

            const tabs = { summary: 0, quiz: 1, flashcards: 2 };
            document.querySelectorAll('.section .tabs .tab')[tabs[tab]].classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        // Register
        document.getElementById('registerBtn').addEventListener('click', async () => {
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const name = document.getElementById('regName').value;
            const resultDiv = document.getElementById('authResult');
            const btn = document.getElementById('registerBtn');

            if (!email || !password || !name) {
                showResult(resultDiv, '‚ùå Please fill in all fields', 'error');
                return;
            }

            if (password.length < 6) {
                showResult(resultDiv, '‚ùå Password must be at least 6 characters', 'error');
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Registering...';

            try {
                const response = await apiCall('/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, name })
                });

                currentUser.token = response.data.token;
                currentUser.email = email;
                currentUser.name = name;

                // Save to session
                sessionStorage.setItem('apiToken', currentUser.token);
                sessionStorage.setItem('userEmail', email);
                sessionStorage.setItem('userName', name);

                showResult(resultDiv, '‚úÖ Registration successful! Loading app...', 'success');
                setTimeout(showApp, 1000);
            } catch (error) {
                showResult(resultDiv, `‚ùå ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Register & Get Started';
            }
        });

        // Login
        document.getElementById('loginBtn').addEventListener('click', async () => {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const resultDiv = document.getElementById('authResult');
            const btn = document.getElementById('loginBtn');

            if (!email || !password) {
                showResult(resultDiv, '‚ùå Please fill in all fields', 'error');
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Logging in...';

            try {
                const response = await apiCall('/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                currentUser.token = response.data.token;
                currentUser.email = email;
                currentUser.name = response.data.name || email;

                // Save to session
                sessionStorage.setItem('apiToken', currentUser.token);
                sessionStorage.setItem('userEmail', email);
                sessionStorage.setItem('userName', currentUser.name);

                showResult(resultDiv, '‚úÖ Login successful! Loading app...', 'success');
                setTimeout(showApp, 1000);
            } catch (error) {
                showResult(resultDiv, `‚ùå ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Login';
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', logout);

        // Upload Document
        document.getElementById('uploadBtn').addEventListener('click', uploadDocument);

        // Refresh Documents List
        document.getElementById('refreshDocsBtn').addEventListener('click', loadDocuments);

        // Process Document
        document.getElementById('processBtn').addEventListener('click', processDocument);

        // Generate Summary
        document.getElementById('generateSummaryBtn').addEventListener('click', generateSummary);

        // Generate Quiz
        document.getElementById('generateQuizBtn').addEventListener('click', generateQuiz);

        // Generate Flashcards
        document.getElementById('generateFlashcardsBtn').addEventListener('click', generateFlashcards);

        // Tab switching - use event delegation
        document.querySelectorAll('.tab[data-tab]').forEach(tab => {
            tab.addEventListener('click', (e) => {
                const tabName = e.target.getAttribute('data-tab');
                switchContentTab(tabName);
            });
        });

        // Show App
        function showApp() {
            document.getElementById('loginSection').classList.remove('active');
            document.getElementById('appSection').classList.add('active');
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;
            loadDocuments();
        }

        // Logout
        function logout() {
            sessionStorage.clear();
            currentUser = { token: null, email: null, name: null };
            document.getElementById('loginSection').classList.add('active');
            document.getElementById('appSection').classList.remove('active');
        }

        // Upload Document
        async function uploadDocument() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const resultDiv = document.getElementById('uploadResult');
            const btnText = document.getElementById('uploadBtnText');

            if (!file) {
                showAlert(resultDiv, '‚ùå Please select a file', 'error');
                return;
            }

            btnText.innerHTML = '<span class="loading"></span> Uploading...';

            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch(`${API_BASE}/documents/upload`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentUser.token}`
                    },
                    body: formData
                });

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error?.message || 'Upload failed');
                }

                showAlert(resultDiv, `‚úÖ Document uploaded successfully! ID: ${data.documentId}`, 'success');
                fileInput.value = '';
                loadDocuments();
            } catch (error) {
                showAlert(resultDiv, `‚ùå ${error.message}`, 'error');
            } finally {
                btnText.textContent = 'Upload Document';
            }
        }

        // Load Documents
        async function loadDocuments() {
            const listDiv = document.getElementById('documentsList');
            listDiv.innerHTML = '<div class="loading"></div> Loading...';

            try {
                const response = await apiCall('/documents');
                documents = response.data;

                if (documents.length === 0) {
                    listDiv.innerHTML = '<div class="alert alert-info">No documents uploaded yet. Upload one above!</div>';
                    return;
                }

                listDiv.innerHTML = documents.map(doc => `
                    <div class="document-item ${doc.documentId === selectedDocumentId ? 'selected' : ''}"
                         onclick="selectDocument('${doc.documentId}')">
                        <div>
                            <strong>${doc.filename}</strong>
                            <span class="badge badge-${doc.status === 'completed' ? 'success' : doc.status === 'uploaded' ? 'warning' : 'info'}">
                                ${doc.status}
                            </span>
                            <br>
                            <small>Uploaded: ${new Date(doc.uploadedAt).toLocaleString()}</small>
                            ${doc.wordCount ? `<br><small>Words: ${doc.wordCount}</small>` : ''}
                        </div>
                        <div>
                            <button class="btn" onclick="event.stopPropagation(); selectDocument('${doc.documentId}')">
                                Select
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                listDiv.innerHTML = `<div class="alert alert-error">‚ùå ${error.message}</div>`;
            }
        }

        // Select Document
        function selectDocument(docId) {
            selectedDocumentId = docId;
            const doc = documents.find(d => d.documentId === docId);

            document.getElementById('noDocSelected').classList.add('hidden');
            document.getElementById('contentGeneration').classList.remove('hidden');
            document.getElementById('selectedDocName').textContent = doc.filename;

            loadDocuments(); // Refresh to show selection
        }

        // Process Document
        async function processDocument() {
            if (!selectedDocumentId) return;

            const btnText = document.getElementById('processBtnText');
            btnText.innerHTML = '<span class="loading"></span> Processing...';

            try {
                await apiCall(`/documents/${selectedDocumentId}/process`, {
                    method: 'POST'
                });

                alert('‚úÖ Document processed successfully! You can now generate content.');
                loadDocuments();
            } catch (error) {
                alert(`‚ùå ${error.message}`);
            } finally {
                btnText.textContent = 'Extract Text';
            }
        }

        // Generate Summary
        async function generateSummary() {
            if (!selectedDocumentId) return;

            const summaryType = document.getElementById('summaryType').value;
            const resultDiv = document.getElementById('summaryResult');
            const btnText = document.getElementById('summaryBtnText');

            btnText.innerHTML = '<span class="loading"></span> Generating...';
            resultDiv.classList.remove('hidden');
            resultDiv.textContent = 'Generating summary...';

            try {
                const response = await apiCall('/generate/summary', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        documentId: selectedDocumentId,
                        summaryType
                    })
                });

                const summary = response.summary;
                resultDiv.textContent = `‚úÖ SUMMARY GENERATED

Title: ${summary.title}
Type: ${summary.documentType}

Overview:
${summary.overview}

Key Points:
${summary.keyPoints.map((p, i) => `${i + 1}. ${p}`).join('\n')}

Main Topics:
${summary.mainTopics.join(', ')}

Important Terms:
${summary.importantTerms.map(t => `- ${t.term}: ${t.definition}`).join('\n')}

Reading Time: ${summary.estimatedReadTime}
`;
            } catch (error) {
                resultDiv.textContent = `‚ùå Error: ${error.message}`;
            } finally {
                btnText.textContent = 'Generate Summary';
            }
        }

        // Generate Quiz
        async function generateQuiz() {
            if (!selectedDocumentId) return;

            const questionCount = parseInt(document.getElementById('questionCount').value);
            const select = document.getElementById('questionTypes');
            const questionTypes = Array.from(select.selectedOptions).map(opt => opt.value);
            const resultDiv = document.getElementById('quizResult');
            const btnText = document.getElementById('quizBtnText');

            btnText.innerHTML = '<span class="loading"></span> Generating...';
            resultDiv.classList.remove('hidden');
            resultDiv.textContent = 'Generating quiz...';

            try {
                const response = await apiCall('/generate/quiz', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        documentId: selectedDocumentId,
                        questionCount,
                        questionTypes
                    })
                });

                const quiz = response.quiz;
                resultDiv.textContent = `‚úÖ QUIZ GENERATED

Title: ${quiz.title}
${quiz.description}

Questions:

${quiz.questions.map((q, i) => `
${i + 1}. ${q.question}
   Type: ${q.type}
   ${q.options ? q.options.map((opt, j) => `   ${String.fromCharCode(65 + j)}. ${opt}`).join('\n') : ''}

   ‚úì Correct Answer: ${q.correctAnswer}
   üí° Explanation: ${q.explanation}
`).join('\n')}
`;
            } catch (error) {
                resultDiv.textContent = `‚ùå Error: ${error.message}`;
            } finally {
                btnText.textContent = 'Generate Quiz';
            }
        }

        // Generate Flashcards
        async function generateFlashcards() {
            if (!selectedDocumentId) return;

            const cardCount = parseInt(document.getElementById('cardCount').value);
            const resultDiv = document.getElementById('flashcardsResult');
            const btnText = document.getElementById('flashcardsBtnText');

            btnText.innerHTML = '<span class="loading"></span> Generating...';
            resultDiv.classList.remove('hidden');
            resultDiv.textContent = 'Generating flashcards...';

            try {
                const response = await apiCall('/generate/flashcards', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        documentId: selectedDocumentId,
                        cardCount
                    })
                });

                const flashcards = response.flashcards;
                resultDiv.textContent = `‚úÖ FLASHCARDS GENERATED

Title: ${flashcards.title}
${flashcards.description}

Cards:

${flashcards.cards.map((card, i) => `
Card ${i + 1}:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Front: ${card.front}
Back: ${card.back}

Category: ${card.category} | Difficulty: ${card.difficulty}
${card.hint ? `üí° Hint: ${card.hint}` : ''}
Tags: ${card.tags.join(', ')}
`).join('\n')}
`;
            } catch (error) {
                resultDiv.textContent = `‚ùå Error: ${error.message}`;
            } finally {
                btnText.textContent = 'Generate Flashcards';
            }
        }

        // Helper: API Call
        async function apiCall(endpoint, options = {}) {
            const url = `${API_BASE}${endpoint}`;
            const headers = {
                ...options.headers,
                ...(currentUser.token ? { 'Authorization': `Bearer ${currentUser.token}` } : {})
            };

            const response = await fetch(url, {
                ...options,
                headers
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error?.message || 'Request failed');
            }

            return data;
        }

        // Helper: Show Result
        function showResult(div, message, type) {
            div.textContent = message;
            div.classList.remove('hidden');
            div.style.background = type === 'error' ? '#fee' : '#efe';
            div.style.color = type === 'error' ? '#c00' : '#060';
        }

        // Helper: Show Alert
        function showAlert(div, message, type) {
            div.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            div.classList.remove('hidden');
        }
    </script>
</body>
</html>
